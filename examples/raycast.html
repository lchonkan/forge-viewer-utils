<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Autodesk Forge Viewer Booster: Basic Example</title>
    <link rel="stylesheet" href="https://developer.api.autodesk.com/modelderivative/v2/viewers/6.*/style.css">
    <script src="https://developer.api.autodesk.com/modelderivative/v2/viewers/6.*/viewer3D.js"></script>
    <script src="/PowerViewer.js"></script>
    <style>
        html, body { margin: 0; padding: 0; }
        #viewer { width: 100%; height: 100%; }
    </style>
</head>
<body>
    <div id="viewer"></div>
    <script>

async function getAccessToken(callback) {
    const resp = await fetch('/api/auth');
    const json = await resp.json();
    callback(json.access_token, json.expires_in);
}

async function run() {
    try {
        const powerViewer = await PowerViewer.Initialize(document.getElementById('viewer'), getAccessToken);
        const viewable = await powerViewer.load(window.location.search.substr(1));
        document.getElementById('viewer').addEventListener('click', function(ev) {
            const bounds = ev.target.getBoundingClientRect();
            const intersections = powerViewer.rayCast(ev.clientX - bounds.left, ev.clientY - bounds.top);
            if (intersections.length > 0) {
                const intersection = intersections[0];
                const geometry = new THREE.SphereGeometry(10, 8, 8);
                const material = new THREE.MeshBasicMaterial({ color: 0x336699 });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.x = intersection.point.x;
                mesh.position.y = intersection.point.y;
                mesh.position.z = intersection.point.z;
                powerViewer.addCustomMesh(mesh);
            }
        });
        console.log('Viewable loaded successfully', viewable);
    } catch(err) {
        console.error(err);
    }
}

run();
    </script>
</body>
</html>
